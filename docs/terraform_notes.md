# Terraform

## research notes

При работе с Terraform легко запутаться в терминах — особенно когда речь заходит о VPC в AWS. Важно понимать разницу: aws_vpc — это ресурс, самый базовый «кирпичик». Он создаёт только саму сеть. Все подсети, маршруты и интернет-шлюзы нужно описывать вручную.

Следующий уровень — официальные модули, например terraform-aws-modules/vpc/aws.
Это уже «конструктор из кирпичей», который внутри себя вызывает десятки ресурсов и строит готовую сетевую инфраструктуру: VPC, подсети, NAT, маршрутизацию. Можно сделать свой кастомный модуль (например vpc_lite), где описываются только VPC и интернет-шлюз.

### plan

- `terraform plan` показывает предполагаемые изменения.
- По умолчанию план хранится только в памяти, при `terraform apply` он считается заново.
- Чтобы зафиксировать именно тот план, что я видел, можно:

  ```bash
  terraform plan -out=plan.bin
  terraform apply plan.bin
  ```

В production пайплайнах это обязательно - гарантия, что apply соответствует утверждённому плану.

## plan & apply

В атрибутах команды запуска можно задать значение переменных
например:

```bash
terraform apply -var='aws_region=eu-central-1' -var='aws_profile=default' -var='bucket_name=my-tf-state-kb' -var='table_name=my-tf-locks'
```

При запуске неуказанные в атрибутах переменные будут запрошены интерактивно
